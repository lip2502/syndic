!function(e){"use strict";function s(){var e=i.find(t);e.sortable({connectWith:e,placeholder:"oaken-placeholder",start:function(e,t){t.placeholder.height(t.helper.outerHeight())},stop:function(e,t){d()},containment:i,helper:"clone",handle:".panel-heading"})}function o(){e(".oaken-clear").click(function(e){e.preventDefault(),e.stopPropagation(),h("Clear Storage","Are you sure?",u)}),l()}function l(){if(n.persistence){if("local"===n.persistence){if("undefined"==typeof window.localStorage)return void console.error("localStorage is undefined, persistence features will not work.");c(window.localStorage.getItem("oakenStructure"))}else"remote"===n.persistence&&e.get(n.remoteURL,c)}}function c(a){var r=JSON.parse(a);if(r){if(r.order){var s=r.order,o=e(".panel",i).detach();e.each(s,function(a,l){var c=e(t,i).eq(a);e.each(s[a],function(t,i){var a=i.split(":")[0],s=i.split(":")[1],l=o.filter("#"+a);s&&a!==r.fullscreen&&(e(".panel-body",l).hide(),e(".panel-heading .btn-minmax i",l).removeClass(n.controlsConfig.minmax.iClassFirst).addClass(n.controlsConfig.minmax.iClassSecond),l.data("collapsed",!0)),c.append(l)})})}if(r.fullscreen){var l=e("#"+r.fullscreen),c={scroll:e(window).scrollTop(),top:l.offset().top-e(window).scrollTop(),left:l.offset().left,width:l.width(),height:l.height(),position:l.css("position"),"z-index":l.css("z-index")};l.css({position:"fixed",top:0,left:0,"z-index":999999,width:"100%",height:"100%"}).data("initial",c).addClass("panel-fullscreen"),e(".oakenwidget-control",l).not(".btn-fullscreen").toggle(),e(".btn-fullscreen",l).find("i").toggleClass(n.controlsConfig.fullscreen.iClassFirst).toggleClass(n.controlsConfig.fullscreen.iClassSecond)}}}function d(){if(n.persistence){var a={};1===e(".panel-fullscreen").length?a.fullscreen=e(".panel-fullscreen").attr("id"):delete a.fullscreen;var r=[];if(i.is(".row")&&e(t,i).each(function(){var t=e(this),n=[];e(".panel",t).each(function(){var t=e(this).attr("id");e(this).data("collapsed")&&(t+=":min"),n.push(t)}),r.push(n)}),a.order=r,"local"===n.persistence){if("undefined"==typeof window.localStorage)return;window.localStorage.setItem("oakenStructure",JSON.stringify(a))}else"remote"===n.persistence&&e.post(n.remoteURL,{structure:JSON.stringify(a)})}}function u(){if(n.persistence)if("local"===n.persistence){if("undefined"==typeof window.localStorage)return;window.localStorage.removeItem("oakenStructure"),window.location.reload()}else"remote"===n.persistence&&e.ajax({type:"DELETE",url:n.remoteURL,success:function(){window.location.reload()}})}function f(){var t='<div class="modal modal-danger-filled oaken-confirm" data-easein="bounceIn" data-easeout="bounceOut" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-header"><h4 class="modal-title"></h4></div><div class="modal-body"><span></span></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button><button type="button" class="btn btn-default accept">OK</button></div></div></div></div>';e("body").append(e(t))}function h(t,n,i){var a=e(".oaken-confirm");a.find(".modal-title").text(t),a.find(".modal-body span").text(n),a.find(".accept").off("click.oaken").on("click.oaken",function(){i(),a.modal("hide")}),a.modal("show")}function p(t){var n;n=e(".panel-body",t).length?e(".panel-body",t):t,n.append('<div class="ow-veil"><span class="ow-spinner"><i class="glyphicon glyphicon-refresh ow-rotate"></i></span></div>')}function m(t){e(".ow-veil",t).remove()}var n,i,t="div[class^=col-md-]",a={sortable:!0,controlsConfig:{question:{iClassFirst:"fa fa-question"},fullscreen:{iClassFirst:"fa fa-expand",iClassSecond:"fa fa-compress"},minmax:{iClassFirst:"fa fa-chevron-up",iClassSecond:"fa fa-chevron-down"},close:{iClassFirst:"fa fa-times"}},controlsMap:{},persistence:"local",remoteURL:"/",ajaxLoad:"",ajaxStarted:function(){this.css("position","relative"),p(this)},ajaxCompleted:function(t){e(".panel-body",this).length?e(".panel-body",this).empty().html(t):this.append(e(t)),this.css("position","static"),m(this)},ajaxFailed:function(t){this.css("position","static"),m(this),404===t&&this.append(e("<p>404: Not Found</p>"))}},r={fullscreen:{attributes:{"class":"btn-fullscreen oakenwidget-control"},behaviour:function(a){var l,r=e(this).data("w"),o=e(".oakenwidget-control",r);a.preventDefault(),a.stopPropagation(),r.toggleClass("panel-fullscreen"),r.data("collapsed")&&e(".panel-body",r).toggle(r.is(".panel-fullscreen"));i.find(t);r.is(".panel-fullscreen")?(l={scroll:e(window).scrollTop(),top:r.offset().top-e(window).scrollTop(),left:r.offset().left,width:r.width(),height:r.height(),position:r.css("position"),"z-index":r.css("z-index")},r.css({position:"fixed",top:l.top,left:l.left,width:l.width,height:l.height,"z-index":999999}).animate({width:"100%",height:"100%",top:0,left:0},500,function(){n.sortable&&i.find(t).sortable("destroy"),d()}).data("initial",l),e("body").css("overflow","hidden")):(l=r.data("initial"),r.animate({top:l.top,left:l.left,width:l.width,height:l.height},500,function(){r.css({position:l.position,"z-index":l["z-index"],width:l.width,height:l.height}),e(window).scrollTop(l.scroll),n.sortable&&(r.css({width:"100%",height:"auto"}),s(),e("body").css("overflow","auto"),d())}).data("initial",void 0)),o.not(this).toggle(),e(this).find("i").toggleClass(n.controlsConfig.fullscreen.iClassFirst).toggleClass(n.controlsConfig.fullscreen.iClassSecond)}},minmax:{attributes:{"class":"btn-minmax oakenwidget-control"},behaviour:function(t){t.preventDefault(),t.stopPropagation();var i=e(this).data("w");e("i",e(this)).toggleClass(n.controlsConfig.minmax.iClassFirst).toggleClass(n.controlsConfig.minmax.iClassSecond),e(".panel-body",i).slideToggle(function(){i.data("collapsed",!e(".panel-body",i).is(":visible")),d()})}},close:{attributes:{"class":"btn-close oakenwidget-control"},behaviour:function(t){t.preventDefault(),t.stopPropagation();var n=e(this).data("w");h("Delete widget","Are you sure?",function(){n.fadeOut().remove(),d()})}}};e.fn.oakenwidgets=function(t){if(1!==this.length)throw new Error("only one oakenwidgets container per page is supported");var l=!1;if(this.is(".row"))l=!0;else{var c=!0;this.children().each(function(){return e(this).is(".row")?void 0:void(c=!1)}),l=c}if(!l)throw new Error("oakenwidgets must be a bs row or something containing rows and only rows");n=e.extend(a,t),i=this;var d=n.controlsMap;return i.find(".panel").each(function(){var t=e(this),i=t.attr("id"),a=e('<div class="pull-right"></div>'),s=e('<div class="clearfix"></div>'),o=t.data("controls-map");"string"==typeof o&&(d[i]=t.data("controls-map")),e.each(r,function(r,s){if("string"!=typeof d[i]||-1!==d[i].indexOf(r)){var o=e('<a href="#"><i class="'+n.controlsConfig[r].iClassFirst+'"></i></a>');e.each(s.attributes,function(e,t){"data-target"===e&&(t=t.replace("{id}",i)),o.attr(e,t)}),o.data("w",t),o.click(s.behaviour),o.appendTo(a)}});var l=t.data("ajax-load");l&&("function"==typeof n.ajaxStarted&&n.ajaxStarted.call(t),e.ajax({method:"GET",url:l,success:function(e){"function"==typeof n.ajaxCompleted&&n.ajaxCompleted.call(t,e)},error:function(e){"function"==typeof n.ajaxFailed&&n.ajaxFailed.call(t,e.status)}})),e(".panel-heading",t).append(a).append(s)}),n.sortable&&s(),f(),i.show(),o(),i}}(jQuery);